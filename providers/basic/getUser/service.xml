<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="c354b982-e80d-449e-bb5e-b550bf44d52d"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="c45dd150-a648-4a02-b0d1-3fd3c5993684"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="30f27335-08a1-454b-9ba3-194ebf77900a"
				serviceId="nabu.cms.oauth2.client.providers.basic.getExistingUser"
				resultName="result5e1c93f80d474254bce7f37861703240"
				temporaryMapping="true"
				x="92"
				y="49"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8c24de79-4ea2-42c0-a60c-bd49b1acd759"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/oauth2ProviderId</from>
				<to>oauth2ProviderId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="c7beb0c8-b2e2-4fb3-ae42-4d64ed83105b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/token</from>
				<to>token</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="06edd3b5-c100-484e-a381-efb1891ab2c7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/userInfo</from>
				<to>userInfo</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="743b4b80-035e-48b4-b1c6-5b7bff130e62"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5e1c93f80d474254bce7f37861703240/userId</from>
			<to>output/userId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ea67f87e-07bf-4725-9565-925f3291e2f4"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5e1c93f80d474254bce7f37861703240/token</from>
			<to>token</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ed8f5761-8cb6-4bd3-846f-40360079931e"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5e1c93f80d474254bce7f37861703240/realm</from>
			<to>realm</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="336f35a8-4d66-4032-ae23-057f87f000c1"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5e1c93f80d474254bce7f37861703240/externalId</from>
			<to>externalId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="21d1ac43-37e2-45fe-87a8-609a871964b4"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5e1c93f80d474254bce7f37861703240/externalIdTypeId</from>
			<to>externalIdTypeId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="9ce9277f-c99a-4a90-9c2b-cda790821373"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/userInfo</from>
			<to>userInfo</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			comment="If it's not an existing user and we don't have a token or email address, we can't do much here"
			disabled="false"
			id="4c38b04c-265b-4e1f-b6cd-34080c1c6f61"
			label="token == null &amp;&amp; userInfo/email == null &amp;&amp; output/userId == null"
			lineNumber="3"
			message="No token present and no email available" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="28a930a6-a63a-4f1e-a151-787a15572dca"
			lineNumber="4"
			query="output/userId">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="User does not exist yet, create it"
				disabled="false"
				id="84e172a3-7e54-4b55-ac20-164c77fc914f"
				label="null"
				lineNumber="5">
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If the user already exists, select him so we can update the metadata"
			disabled="false"
			id="04a16ee7-ffe1-4fd3-a03d-863a90cf1334"
			label="output/userId != null"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="cc20c9df-e3c4-41fb-a61b-99357297150b"
				serviceId="nabu.cms.core.crud.account.services.get"
				resultName="result0ad4dc384ad04bb5959fbdc42c345fd7"
				temporaryMapping="true"
				x="52"
				y="27"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="13e88104-ff37-43b0-acdc-e7bd80b2406f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>output/userId</from>
				<to>id</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="93a927aa-64cc-498b-8bf9-f4eb674386f4"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0ad4dc384ad04bb5959fbdc42c345fd7/result</from>
			<to>account</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map main content"
			disabled="false"
			id="be48daeb-9c5c-406a-a8e3-776364aca9bf"
			lineNumber="7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="dc0e3d49-776e-4053-ac72-6b8472702b2b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/avatar</from>
			<to>account/avatar</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="a6e5a0a8-c0c2-4300-9288-541728b2654a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/name</from>
			<to>account/name</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="549f3908-16c7-4431-b115-323be6cd4e78"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/nickname</from>
			<to>account/nickname</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="cf36451a-7de2-4437-8ff4-fe71ba980dba"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/profile</from>
			<to>account/profile</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="66fb1393-d7d4-4e37-b205-6e1fafc2b6b5"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/picture</from>
			<to>account/picture</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ebca0ba0-0eec-4a70-9b49-6a9cd19bf933"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/website</from>
			<to>account/website</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="73e1ba38-9242-4e3a-bbfb-1049eb155bb3"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/email</from>
			<to>account/email</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="5dfb545a-ccb1-4f02-81eb-4fdf1d2b2388"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/birthdate</from>
			<to>account/birthdate</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="f4e06137-362a-478b-b474-3ff8c9600a1c"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/locale</from>
			<to>account/locale</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="7918887b-f4d4-4aca-b2bd-a4cf24e2806a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/family_name</from>
			<to>account/familyName</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="04919c26-7355-4bbd-a544-906c21cdb3a2"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/middle_name</from>
			<to>account/middleName</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="644e6a09-df69-4273-b3f2-2f4fcf99d191"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/given_name</from>
			<to>account/givenName</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6e491ba0-5738-4daf-9d69-c4bb24d61085"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/email_verified</from>
			<to>account/emailVerified</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="14185f93-d833-4d34-b475-eb22cda42032"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/zoneinfo</from>
			<to>account/timezone</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d74db794-68fe-4d68-b886-9339ab5a2f51"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/phone_number</from>
			<to>account/phoneNumber</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="163c1114-a7f3-47d4-8c79-1a97a877833a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>userInfo/phone_number_verified</from>
			<to>account/phoneNumberVerified</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ee2974a6-b41e-416f-a1a2-513edd513ebe"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>realm</from>
			<to>account/realm</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="db5fbffe-372c-4bcf-9138-ca2b4755896f"
			label="userInfo/gender != null"
			lineNumber="8">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="713c1a07-6f58-48f0-bb5f-84505d978096"
				serviceId="nabu.cms.core.services.masterdata.entry.get"
				resultName="result3c5a895d356c4ba8ad51c09d513028b2"
				temporaryMapping="true"
				x="85"
				y="93"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="39f55aa4-0219-45dc-927b-386f64bf42da"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>gender</from>
				<to>category</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fee0aa10-a7bc-4366-b6ed-23ab4ab76edc"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>userInfo/gender</from>
				<to>name</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4e9f86e3-c484-44c1-a4a3-098d0c0f5dea"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result3c5a895d356c4ba8ad51c09d513028b2/entryId</from>
			<to>account/genderId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Set alias etc if it is for a new account"
			disabled="false"
			id="d671a880-58f5-4d9b-b1ad-35024355a364"
			label="account/id == null"
			lineNumber="9"
			query="token">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="We create an email account"
				disabled="false"
				id="b019c323-6d0b-492e-b068-4ca9ece6dd94"
				label="null"
				lineNumber="10">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Map the default stuff"
					disabled="false"
					id="07356fba-e010-4e02-adc5-6f27800c6a54"
					lineNumber="11">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="4f45c0dc-3617-4ad9-89c9-0c65c2adfc13"
						serviceId="nabu.cms.core.services.masterdata.entry.get"
						resultName="result7dea5f19617f4342aee75b86aa7887c8"
						temporaryMapping="true"
						x="18"
						y="125"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1a09015c-ccab-4ccd-a3db-a925a21231bb"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>aliasType</from>
						<to>category</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4a5840ff-37d3-44f1-a0d0-a6b802701262"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>email</from>
						<to>name</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="93c578ec-9dfb-4225-a7ca-e8037a46b894"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result7dea5f19617f4342aee75b86aa7887c8/entryId</from>
					<to>account/aliasTypeId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a136f1bc-c2dd-4d8e-8333-a1478e51ed3e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>userInfo/email</from>
					<to>account/alias</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set verified if true"
					disabled="false"
					id="d6d91673-9aa7-4783-927e-f08ea506e69b"
					label="userInfo/email_verified == true"
					lineNumber="12">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="ca4bd277-13e8-4a54-bc6a-d65ac6629484"
						serviceId="nabu.utils.Date.now"
						resultName="resultc6464eb0e08c4b389819b851916ef7b8"
						temporaryMapping="true"
						x="325"
						y="101"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7b861b69-9362-459d-a46c-1b5ebf582ccc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultc6464eb0e08c4b389819b851916ef7b8/date</from>
					<to>account/verified</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="This means we are in the openid scenario, we set an openid alias type"
				disabled="false"
				id="993e0468-a878-47da-b0d4-93cee8abab1c"
				lineNumber="13">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="d96f30eb-2aef-4388-a7f4-734b543c415c"
					serviceId="nabu.utils.Date.now"
					resultName="result147e01dbf19743d389189f9dbeb90034"
					temporaryMapping="true"
					x="63"
					y="166"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="db7567b9-e397-4db6-8e21-f10d58cbd115"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result147e01dbf19743d389189f9dbeb90034/date</from>
				<to>account/verified</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="a0f72ec2-da12-4e7e-9d93-542fa5ac6f2b"
					serviceId="nabu.cms.core.services.masterdata.entry.get"
					resultName="result2b12e8c4181f43d78f0d0ff28481789a"
					temporaryMapping="true"
					x="241"
					y="307"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6ac41900-363d-4a56-a3fa-9d0766f96a4d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>aliasType</from>
					<to>category</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="757759a1-9ee6-4a57-9ef5-eb75119c3740"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>openid</from>
					<to>name</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f4dc0169-1a61-43e4-9330-64ba397a30d3"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result2b12e8c4181f43d78f0d0ff28481789a/entryId</from>
				<to>account/aliasTypeId</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="f7d99975-6ea9-4897-bd7d-c0e60b08264e"
			lineNumber="14"
			query="account/id">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Create the account"
				disabled="false"
				id="451b8d29-3153-4e68-aee7-b68ee70dd447"
				label="null"
				lineNumber="15">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="f59fe3cd-3f10-4f8b-8a34-6eee236be62d"
					serviceId="nabu.cms.core.crud.account.services.create"
					resultName="resultbbc4aba401394d88bbb800cdc151b574"
					temporaryMapping="true"
					x="59"
					y="25"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c260b0cb-265c-4bf3-a19c-a281843316c1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>account</from>
					<to>instance</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="57877433-42d9-4858-bf26-4d33d37fc2a4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultbbc4aba401394d88bbb800cdc151b574/created/id</from>
				<to>output/userId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Update the account"
				disabled="false"
				id="7bdc2488-e86d-459f-83b4-a08dcdda48ac"
				lineNumber="16">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="0fe34637-50cc-45bc-9123-0eeda7817ae7"
					serviceId="nabu.cms.core.crud.account.services.update"
					resultName="resultd84248c7e680405296f4d69a72f12ce8"
					temporaryMapping="true"
					x="60"
					y="46"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="19a48420-80d1-4b30-a590-e2b5ab3f1e6b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>account</from>
					<to>instance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4cf3319f-846b-48fe-84d4-7aedfc5a6602"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>account/id</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a5b0be7f-ddfd-4743-85ed-d4041112462d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>account/id</from>
				<to>output/userId</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Annotate the user if we have a token"
			disabled="false"
			id="c48525c5248243198b23f4d3f5f66b74"
			label="externalId == null &amp;&amp; token != null"
			lineNumber="17">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7a47b6e8b06849c4a14cc41697ec6b24"
				serviceId="nabu.cms.core.crud.nodeExternalId.services.create"
				resultName="result3716095de46d453ca448366aba320eb7"
				temporaryMapping="true"
				x="333"
				y="101"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9c8ff04f2f1947e682530c66e7e7a757"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/sub</from>
				<to>instance/externalId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3f1ff59e614c41799cc36862697c147c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>externalIdTypeId</from>
				<to>instance/externalIdTypeId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="c65d80db3005409ca5a4599b885d88be"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>output/userId</from>
				<to>instance/nodeId</to>
			</steps>
		</steps>
	</steps>
</sequence>